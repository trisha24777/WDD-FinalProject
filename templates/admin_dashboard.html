<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="{{ url_for('static', filename='style/admin_style.css') }}">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <title>WH Admin | Management Portal</title>
</head>
<body>
    <div class="admin-wrapper">
        <!-- Sidebar -->
        <nav class="sidebar">
            <div class="logo-section">
                <a href="/"><img src="{{ url_for('static', filename='images/logo.png') }}" alt="World Hotels Logo" style="height: 50px;"></a>
            </div>
            <ul>
                <li><a href="#reports">üìä Sales Reports</a></li>
                <li><a href="#users">üë• User Management</a></li>
                <li><a href="#inventory">üè® Hotel Inventory</a></li>
                <li><a href="{{ url_for('index') }}">üåê View Public Site</a></li>
                <li class="sidebar-logout">
                    <a href="/logout">üö™ Logout Staff</a>
                </li>
            </ul>
        </nav>

        <!-- Main Content -->
        <main class="content">
            <!-- Header/Stats -->
            <section id="reports">
                <div class="section-header">
                    <h2>Business Performance</h2>
                    <p>Overview of global sales and engagement.</p>
                </div>
                
                <div class="stats-grid">
                    <div class="stat-card">
                        <h4>Total Revenue</h4>
                        <p class="price">{{ "{:,.2f}".format(revenue) }} {{ session.get('currency', 'GBP') }}</p>
                    </div>
                    <div class="stat-card">
                        <h4>Total Bookings</h4>
                        <p class="price">{{ bookings|length }}</p>
                    </div>
                    <div class="stat-card">
                        <h4>Total Users</h4>
                        <p class="price">{{ users|length }}</p>
                    </div>
                </div>

                <!-- Charts -->
                <div class="charts-container">
                    <div class="chart-box">
                        <h4>Sales Performance</h4>
                        <canvas id="salesChart"></canvas>
                    </div>
                    <div class="chart-box">
                        <h4>User Growth</h4>
                        <canvas id="userChart"></canvas>
                    </div>
                    <div class="chart-box">
                        <h4>Room Distribution</h4>
                        <canvas id="roomChart"></canvas>
                    </div>
                </div>

                <h3>Recent Bookings</h3>
                <table class="report-table">
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>City</th>
                            <th>Room Type</th>
                            <th>Revenue</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for b in bookings %}
                        <tr>
                            <td>{{ b.date }}</td>
                            <td>{{ b.city }}</td>
                            <td>{{ b.room }}</td>
                            <td>{{ "{:,.2f}".format(b.total) }} {{ session.get('currency', 'GBP') }}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </section>

            <!-- User Management -->
            <section id="users">
                <div class="section-header">
                    <h2>User Management</h2>
                    <p>Manage registered clientele and access levels.</p>
                </div>
                <table class="report-table">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Username</th>
                            <th>Email</th>
                            <th>Role</th>
                            <th>Joined</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for u in users %}
                        <tr>
                            <td>#{{ u.id }}</td>
                            <td><strong>{{ u.username }}</strong></td>
                            <td>{{ u.email }}</td>
                            <td><span class="badge">{{ u.role }}</span></td>
                            <td>{{ u.created_at.strftime('%Y-%m-%d') }}</td>
                            <td>
                                <a href="{{ url_for('delete_user', user_id=u.id) }}" 
                                   onclick="return confirm('Delete user {{ u.username }}? This action is permanent.')"
                                   class="delete-link">üóë Remove</a>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </section>

            <!-- Hotel Inventory -->
            <section id="inventory">
                <div class="section-header">
                    <h2>Hotel Inventory</h2>
                    <p>Update rates and add new destinations to our portfolio.</p>
                </div>
                
                <div class="add-hotel-form">
                    <h3>Add New Destination</h3>
                    <form action="/admin/add_hotel" method="POST">
                        <input type="text" name="city" placeholder="City Name" required>
                        <input type="number" step="0.01" name="base_rate" placeholder="Base Rate (GBP)" required>
                        <button type="submit" class="btn-gold">Add Hotel</button>
                    </form>
                </div>

                <table class="report-table">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>City</th>
                            <th>Current Rate (GBP)</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for h in hotels %}
                        <tr>
                            <td>#{{ h.id }}</td>
                            <td><strong>{{ h.city }}</strong></td>
                            <td>
                                <form action="/admin/update_rate" method="POST" class="rate-update-form">
                                    <input type="hidden" name="hotel_id" value="{{ h.id }}">
                                    <input type="number" step="0.01" name="new_rate" value="{{ h.base_rate }}">
                                    <button type="submit">Update</button>
                                </form>
                            </td>
                            <td>
                                <a href="/admin/delete_hotel/{{ h.id }}" 
                                   onclick="return confirm('Remove {{ h.city }} from inventory?')"
                                   class="delete-link">üóë Delete</a>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </section>
        </main>
    </div>

    <!-- JSON Data Bridge -->
    <script id="chart-data" type="application/json">
        {{ chart_data|tojson }}
    </script>
    <script src="{{ url_for('static', filename='scripts/admin_charts.js') }}"></script>
</body>
</html>
